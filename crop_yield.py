# -*- coding: utf-8 -*-
"""Crop_yield_06/12/2025.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1UuSnWhR-90lmzcScGoHUDEvDCs41eeJi
"""
import pickle
import pandas as pd

df = pd.read_csv('crop_yield.csv')
print("DataFrame loaded successfully. Displaying the first 5 rows:")
print(df.head())

X = df.drop('Yield_tons_per_hectare', axis=1)
y = df['Yield_tons_per_hectare']

print("Checking for missing values:")
print(X.isnull().sum())
print(y.isnull().sum())


combined_df = pd.concat([X, y], axis=1)
original_rows = combined_df.shape[0]
combined_df.dropna(inplace=True)
removed_rows = original_rows - combined_df.shape[0]
if removed_rows > 0:
    print(f"\nRemoved {removed_rows} rows due to missing values.")
else:
    print("\nNo missing values found, no rows removed.")

X = combined_df.drop('Yield_tons_per_hectare', axis=1)
y = combined_df['Yield_tons_per_hectare']

categorical_cols = ['Region', 'Soil_Type', 'Crop', 'Fertilizer_Used', 'Irrigation_Used', 'Weather_Condition']


for col in ['Fertilizer_Used', 'Irrigation_Used']:
    if col in categorical_cols and X[col].dtype == 'bool':
        X[col] = X[col].astype(int)

X = pd.get_dummies(X, columns=categorical_cols, drop_first=True)

print("\nProcessed Features (X) head:")
print(X.head())
print("\nTarget Variable (y) head:")
print(y.head())


from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression

# Split the data into training and testing sets
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

print(f"X_train shape: {X_train.shape}")
print(f"X_test shape: {X_test.shape}")
print(f"y_train shape: {y_train.shape}")
print(f"y_test shape: {y_test.shape}")

# Instantiate the model
model = LinearRegression()

# Train the model
model.fit(X_train, y_train)

print("Model training complete.")


from sklearn.metrics import r2_score, mean_absolute_error, mean_squared_error
import numpy as np


y_pred = model.predict(X_test)


r2 = r2_score(y_test, y_pred)
mae = mean_absolute_error(y_test, y_pred)
mse = mean_squared_error(y_test, y_pred)
rmse = np.sqrt(mse)


print(f"R-squared: {r2:.4f}")
print(f"Mean Absolute Error (MAE): {mae:.4f}")
print(f"Root Mean Squared Error (RMSE): {rmse:.4f}")

import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np

# Create a scatter plot of actual vs. predicted values
plt.figure(figsize=(10, 7))
sns.scatterplot(x=y_test, y=y_pred, alpha=0.6)

# Plot a perfect prediction line
# Find the min and max values across both actual and predicted to set limits for the line
min_val = min(y_test.min(), y_pred.min())
max_val = max(y_test.max(), y_pred.max())
plt.plot([min_val, max_val], [min_val, max_val], color='red', linestyle='--', linewidth=2, label='Perfect Prediction')

plt.title('Actual vs. Predicted Crop Yield (Linear Regression)', fontsize=16)
plt.xlabel('Actual Yield (tons per hectare)', fontsize=12)
plt.ylabel('Predicted Yield (tons per hectare)', fontsize=12)
plt.grid(True, linestyle='--', alpha=0.7)
plt.legend()
plt.tight_layout()
plt.show()

import pandas as pd

def predict_yield(model, X_train_cols, Region, Soil_Type, Crop, Rainfall_mm, Temperature_Celsius, Fertilizer_Used, Irrigation_Used, Weather_Condition, Days_to_Harvest):

    input_data = {
        'Region': [Region],
        'Soil_Type': [Soil_Type],
        'Crop': [Crop],
        'Rainfall_mm': [Rainfall_mm],
        'Temperature_Celsius': [Temperature_Celsius],
        'Fertilizer_Used': [Fertilizer_Used],
        'Irrigation_Used': [Irrigation_Used],
        'Weather_Condition': [Weather_Condition],
        'Days_to_Harvest': [Days_to_Harvest]
    }


    input_df = pd.DataFrame(input_data)


    for col in ['Fertilizer_Used', 'Irrigation_Used']:
        if col in input_df.columns and input_df[col].dtype == 'bool':
            input_df[col] = input_df[col].astype(int)


    categorical_cols = ['Region', 'Soil_Type', 'Crop', 'Fertilizer_Used', 'Irrigation_Used', 'Weather_Condition']
    input_df_processed = pd.get_dummies(input_df, columns=categorical_cols, drop_first=True)


    input_df_aligned = input_df_processed.reindex(columns=X_train_cols, fill_value=0)


    prediction = model.predict(input_df_aligned)

    return prediction[0]

print("Prediction function defined.")

X_train_cols = X_train.columns


example_region = 'West'
example_soil_type = 'Sandy'
example_crop = 'Cotton'
example_rainfall = 800.0
example_temperature = 25.0
example_fertilizer_used = True
example_irrigation_used = True
example_weather_condition = 'Cloudy'
example_days_to_harvest = 120

predicted_yield = predict_yield(
    model,
    X_train_cols,
    example_region,
    example_soil_type,
    example_crop,
    example_rainfall,
    example_temperature,
    example_fertilizer_used,
    example_irrigation_used,
    example_weather_condition,
    example_days_to_harvest
)

print(f"Predicted Yield (tons per hectare) for the given inputs: {predicted_yield:.2f}")

# Save trained model
with open("crop_yield_model.pkl", "wb") as f:
    pickle.dump(model, f)

# Save feature columns
with open("model_features.pkl", "wb") as f:
    pickle.dump(X_train.columns, f)

print("Model and feature columns saved successfully!")